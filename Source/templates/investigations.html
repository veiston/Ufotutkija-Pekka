<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>UFOtutkiJA</title>
    <link rel="icon" href="static/favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/logo.css" />
    <link rel="stylesheet" href="/static/css/button.css" />
    <link rel="stylesheet" href="/static/css/hero.css" />
    <link rel="stylesheet" href="/static/css/spotlight.css" />
    <link rel="stylesheet" href="/static/css/flashlight.css" />

    <script src="/static/js/spotlight.js" defer></script>
    <script src="/static/js/flashlight.js" defer></script>
  </head>
  <body>
    <div id="spotlight" class="spotlight"></div>
    <img src="/static/images/flashlight.png" class="flashlight" id="flashlight" />
    <audio id="flashlight-sound" src="/static/audio/flashlight.mp3" preload="auto"></audio>

    <div class="logo">UF0tutkiJA</div>

    <div class="hero">
      <div class="hero__container hero__background">
        <div class="hero__box">
            <div class="hero__box-header">
                <h2 id="investigationCity" class="hero__box-title">

                </h2>
            </div>
          <div class="hero__text-wrap">
            <div class="hero__text" id="investigationText">
              <!-- messages container-->
            </div>
          </div>
            <div class="hero__actions" id="investigationActions">

            </div>
        </div>
      </div>
    </div>
    <script>
      const fetchInvestigation = async () => {
        let currentStep = null;
        let story = null;
        const textContainer = document.getElementById("investigationText");
        const actionsContainer = document.getElementById("investigationActions");
        const cityContainer = document.getElementById("investigationCity");

        const renderStep = (stepNumber) => {
          const stepData = story.steps[stepNumber];
          textContainer.innerHTML = `<p>${stepData.text}</p>`;

          actionsContainer.innerHTML = "";

          Object.entries(stepData.choices).reverse().forEach(([key, value]) => {
            const button = document.createElement("button");
            button.className = key === "examine" ? "button" : "button button--blue-dark";
            button.textContent = value.text;
            button.addEventListener("click", () => {
              currentStep = value.next_step;
              renderStep(currentStep);
            });
            actionsContainer.appendChild(button);
          });
        };

        try {
          const response = await fetch("/investigations/start");
          story = await response.json();
          cityContainer.innerText = story.city;

          // if (story && story.description) {
          //   const descriptionEl = document.createElement("p");
          //   descriptionEl.textContent = story.description;
          //   textContainer.appendChild(descriptionEl);
          // }

          currentStep = story.step;
          renderStep(currentStep);
        } catch (error) {
          console.error("Failed to load investigation:", error);
          textContainer.textContent = "Error loading investigation.";
        }
      };

      fetchInvestigation();
    </script>
  </body>
</html>